{% load static %}
<!-- https://www.bootdey.com/snippets/view/bs4-profile-with-timeline-posts -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkMe</title>
    <link href="{% static 'core/css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'core/css/profile.css' %}" rel="stylesheet">
    <style>
        body {
            background-image: url('../../static/assets/images/bg/stacked-peaks-haikei-1.svg');
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body>
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://site-assets.fontawesome.com/releases/v6.2.1/css/all.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css"
      integrity="sha384-b6lVK+yci+bfDmaY1u0zE8YYJt0TZxLEAFyYSLHId4xoVvsrQu3INevFKo+Xir8e" crossorigin="anonymous">
<script type='text/javascript' src='{% static "core/js/bootstrap.bundle.min.js" %}'></script>
{% include 'navbar.html' %}

<div class="container-sm bd-gutter mt-3 my-md-4 bd-layout" style="padding-top:32px">
    <hr>
    <div class="row">
        <div class="col-md-12">
            <div id="content" class="content content-full-width">
                {% block content %}
                {% endblock %}
            </div>
        </div>
    </div>
</div>
<div class="col-12">
    <button type="button" class="btn btn-light post-button" value="Post" role="img" data-bs-toggle="modal"
            data-bs-target="#postModal">
        <img src="{% static 'assets/images/logo/svg/pencil-square.svg' %}" alt="Bootstrap" width="32" height="32">
        <figcaption><strong>Post bLink</strong></figcaption>
    </button>
    <div class="modal fade" id="postModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Create New Post</h5>
                </div>
                <div class="modal-body">
                    <form action="" method="POST" id="post_create_form">
                        {% csrf_token %}
                        <input name="form_name" type="hidden" id="form-name" value="post-create-form">
                        <div class="form-group text-secondary">
                            <label for="link" class="col-form-label"><strong>Tag Name</strong></label>
                            <input name="link" type="text" class="form-control" id="link" placeholder="Enter the link">
                            <hr>
                            <label for="caption" class="col-form-label"><strong>Caption</strong></label>
                            <textarea name="caption" class="form-control" id="caption"
                                      placeholder="Enter the caption"></textarea>
                            <hr>
                            <div style="display: flex;">
                                {# Implementation of Tags #}
                                <div class="dropdown"
                                     style="display: inline-block;">
                                    <button class="btn btn-default dropdown-toggle"
                                            type="button" data-bs-toggle="dropdown"
                                            aria-haspopup="true"
                                            aria-expanded="true"
                                            aria-label="Tag select">
                                        <span id="tagLabel">Select Tags</span>
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu ml-2">
                                        {% for tag in available_tags %}
                                            {% if tag.name != ' ' %}
                                                <li>
                                                    <input type="checkbox"
                                                           id="{{ tag.name }}"
                                                           name="tag-{{ forloop.counter0 }}"
                                                           value="{{ tag.name }}"
                                                            {% if tag in post.tags.all %}
                                                           checked
                                                            {% endif %}
                                                    >
                                                    <label for="{{ tag.name }}">{{ tag.name }}</label>
                                                </li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                </div>

                                {# Implementation of Spaces #}
                                <div class="dropdown"
                                     style="display: inline-block;">
                                    <button class="btn btn-default dropdown-toggle"
                                            type="button" data-bs-toggle="dropdown"
                                            aria-haspopup="true"
                                            aria-expanded="true"
                                            aria-label="Space select">
                                        <span id="spaceLabel">Select Space</span>
                                        <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu ml-2">
                                        {% for space in available_spaces %}
                                            {% if space.name != " " %}
                                                <li>
                                                    <input type="radio"
                                                           id="space"
                                                           name="space"
                                                           value="{{ space.name }}"
                                                            {% if space in post.spaces.all %}
                                                           checked
                                                            {% endif %}
                                                    >
                                                    <label for="space">{{ space.name }}</label>
                                                </li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="close" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="post_create_form" class="btn btn-primary" onclick="return checkform();">
                        Create Post
                    </button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="tagModal" tabindex="-1" role="dialog" aria-labelledby="createTagModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Create New Tag</h5>
                </div>
                <div class="modal-body">
                    <form action="" method="POST" id="tag_create_form">
                        {% csrf_token %}
                        <input name="form_name" type="hidden" id="form-name" value="tag-create-form">
                        <div class="form-group text-secondary">
                            <label for="tag_name" class="col-form-label"><strong>Link</strong></label>
                            <input name="tag_name" type="text" class="form-control" id="tag_name"
                                   placeholder="Enter the Tag">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="close" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" form="tag_create_form" class="btn btn-primary"
                            onclick="return checkform_create_tags();">
                        Create Post
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>


</body>
{#<!-- Prevents posting empty post-creating-form -->#}
<script type='text/javascript'>
    function checkform() {
        if (document.forms.post_create_form.link.value == "" || document.forms.post_create_form.caption.value == "") {
            alert("Please fill all fields");
            return false;
        } else {
            console.log(document.forms.post_create_form.link.value)
            document.post_create_form.submit();
            document.post_create_form.reset();
        }
    }
</script>
{#Prevents posting empty post-update-form#}
<script type='text/javascript'>
    function checkform_validity() {
        if (document.forms.post_update_form.link.value == "" & document.forms.post_update_form.caption.value == "") {
            alert("Please fill at least 1 field");
            return false;
        } else {
            console.log(document.forms.post_update_form.link.value)
            document.post_update_form.submit();
            document.post_update_form.reset();
        }
    }
</script>
{#<!-- Prevents posting empty post-creating-form -->#}
<script type='text/javascript'>
    function checkform_tags() {
        if (document.forms.tag_search_form.tag_name_to_be_searched.value == "") {
            alert("Please fill all fields");
            return false;
        } else {
            document.tag_search_form.submit();
            document.tag_search_form.reset();
        }
    }
</script>
<script type='text/javascript'>
    function checkform_create_tags() {
        if (document.forms.tag_create_form.tag_name.value == "") {
            alert("Empty tag cannot be created!");
            return false;
        } else {
            document.tag_search_form.submit();
            document.tag_search_form.reset();
        }
    }
</script>
{#//Program to disable or enable a button using javascript https://flexiple.com/javascript/disable-button-javascript/#}
<script>
    let input = document.querySelector(".input");
    let button = document.querySelector(".button");

    button.disabled = true; //setting button state to disabled

    input.addEventListener("change", stateHandle);

    function stateHandle() {
        if (document.querySelector(".input").value === "") {
            button.disabled = true; //button remains disabled
        } else {
            button.disabled = false; //button is enabled
        }
    }
</script>
<script type='text/javascript'>
    function checkform_create_spaces() {
        if (document.forms.space_create_form.space_name.value == "") {
            alert("Empty tag cannot be created!");
            return false;
        } else {
            document.space_create_form.submit();
            document.space_create_form.reset();
        }
    }
</script>
{% block js %}

{% endblock %}
</html>